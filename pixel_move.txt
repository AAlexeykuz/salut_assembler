.EQU waiting_time, 10

; R1, R2 - x, y курсора
; R3, R4 - x, y поставленной точки
; R14 - поставлена ли точка
; R15 - горит ли курсор

MOV IA, input_handling
waiting:
    MOV IM, 1
    MOV R0, waiting_time
    .loop:
        DEC R0, R0
        JNZ .loop
    MOV IM, 0
    LSB R15
    JS .if_pixel_on
        ; else  
        CALL pixel_on
        MOV R15, 1
        JMP waiting
    .if_pixel_on:
        CALL pixel_off
        MOV R15, 0
        JMP waiting




input_handling:
    MOV IM, 0
    PUSH PS
    PUSH R0

    IN r0, p0
    CMP r0, 0
    JE .left
    CMP r0, 1
    JE .up
    CMP r0, 2
    JE .down
    CMP r0, 3
    JE .right
    CMP r0, 7
    JE .click

    JMP .func_end2

    .left:
        LSB R15
        JNS .left_skip
        CALL pixel_off
        .left_skip:
        DEC R1, R1
        JMP .func_end
    .up:
        LSB R15
        JNS .up_skip
        CALL pixel_off
        .up_skip:
        INC R2, R2
        JMP .func_end
    .right:
        LSB R15
        JNS .right_skip
        CALL pixel_off
        .right_skip:
        INC R1, R1
        JMP .func_end
    .down:
        LSB R15
        JNS .down_skip
        CALL pixel_off
        .down_skip:
        DEC R2, R2
        JMP .func_end
    .click:
        NOP
    
    .func_end:
    JNS .func_end2
    CALL pixel_on
    .func_end2:
    POP R0
    POP PS
    MOV IM, 1
    RET

.include screen_lib.txt